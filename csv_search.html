<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Search</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 6px 8px;
            text-align: left;
        }

        th {
            background: #eee;
        }

        .error {
            color: #b00020;
            font-weight: bold;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<h2>CSV Search</h2>

<input
    id="search"
    type="text"
    placeholder="Search keywordsâ€¦"
    disabled
>

<p id="error" class="error hidden"></p>

<table id="table" class="hidden">
    <thead></thead>
    <tbody></tbody>
</table>

<script>
(function () {
    var csvUrl = "https://pbvppkf0kuzw4c6s.public.blob.vercel-storage.com/csv_seach_2.csv";
    var rows = [];
    var headers = [];

    var searchInput = document.getElementById("search");
    var table = document.getElementById("table");
    var thead = table.querySelector("thead");
    var tbody = table.querySelector("tbody");
    var errorEl = document.getElementById("error");

    function showError(msg) {
        errorEl.textContent = msg;
        errorEl.className = "error";
        searchInput.disabled = true;
    }

    function parseCSV(text) {
        var data = [];
        var row = [];
        var cell = "";
        var inQuotes = false;

        for (var i = 0; i < text.length; i++) {
            var c = text[i];
            var next = text[i + 1];

            if (c === '"') {
                if (inQuotes && next === '"') {
                    cell += '"';
                    i++;
                } else {
                    inQuotes = !inQuotes;
                }
            } else if (c === ',' && !inQuotes) {
                row.push(cell);
                cell = "";
            } else if ((c === '\n' || c === '\r') && !inQuotes) {
                if (cell.length || row.length) {
                    row.push(cell);
                    data.push(row);
                }
                row = [];
                cell = "";
                if (c === '\r' && next === '\n') i++;
            } else {
                cell += c;
            }
        }

        if (cell.length || row.length) {
            row.push(cell);
            data.push(row);
        }

        headers = data.shift() || [];
        return data;
    }

    function renderTable(data) {
        thead.innerHTML = "";
        tbody.innerHTML = "";

        var tr = document.createElement("tr");
        headers.forEach(function (h) {
            var th = document.createElement("th");
            th.textContent = h;
            tr.appendChild(th);
        });
        thead.appendChild(tr);

        data.forEach(function (row) {
            var tr = document.createElement("tr");
            row.forEach(function (cell) {
                var td = document.createElement("td");
                td.textContent = cell;
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });

        table.className = "";
    }

    function filterRows(query) {
        if (!query) {
            renderTable(rows);
            return;
        }

        var terms = query.toLowerCase().split(/\s+/);

        var filtered = rows.filter(function (row) {
            var text = row.join(" ").toLowerCase();
            for (var i = 0; i < terms.length; i++) {
                if (text.indexOf(terms[i]) === -1) {
                    return false;
                }
            }
            return true;
        });

        renderTable(filtered);
    }

    fetch(csvUrl)
        .then(function (res) {
            if (!res.ok) {
                throw new Error("CSV missing");
            }
            return res.text();
        })
        .then(function (text) {
            rows = parseCSV(text);
            renderTable(rows);
            searchInput.disabled = false;
        })
        .catch(function () {
            showError("No CSV file found at " + csvUrl);
        });

    searchInput.addEventListener("input", function () {
        filterRows(this.value);
    });
})();
</script>

</body>
</html>
